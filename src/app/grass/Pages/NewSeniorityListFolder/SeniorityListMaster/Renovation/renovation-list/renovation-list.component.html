<div nz-row nzType="flex" style="margin-bottom: 5px">
  <div nz-col nzXs="24" nzSm="24" nzMd="20" nzLg="20" nzXl="12" nzSpan="12">
    <div class="formname">{{ formTitle }}</div>
  </div>

  <div
    nz-col
    nzXs="24"
    nzSm="24"
    nzMd="4"
    nzLg="6"
    nzXl="12"
    style="display: flex; justify-content: flex-end"
  >
    <button
      style="margin-right: 10px"
      [nzType]="isFilterApplied"
      nz-button
      (click)="showFilter()"
      nz-tooltip
      nzTooltipTitle="Filter "
    >
      <i nz-icon nzType="filter"></i>
    </button>

    <form nz-form [nzLayout]="'inline'">
      <nz-form-item style="margin-right: 0px; padding-right: 0px">
        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
          <input
            type="text"
            (keyup)="search(true)"
            name="search"
            nz-input
            placeholder="Search Records"
            [(ngModel)]="searchText"
          />
        </nz-input-group>

        <ng-template #suffixIconButton>
          <button nz-button nzType="primary" (click)="search(true)" nzSearch>
            <i nz-icon nzType="search"></i>
          </button>
        </ng-template>
      </nz-form-item>
    </form>
  </div>
</div>

<div nz-row>
  <div nz-col nzSpan="24">
    <div class="filter {{ filterClass }}">
      <div class="filter-box">
        <form nz-form>
          <div nz-row>
            <div nz-col nzSpan="7">
              <nz-form-item>
                <nz-form-label nzRequired nzNoColon>Select Month</nz-form-label>
                <nz-form-control>
                  <nz-range-picker
                    name="month1"
                    nzMode="month"
                    [(ngModel)]="selectFromMonth"
                    nzPlaceholder="Please select Month & year"
                    nzFormat="MMM/yyyy"
                    (ngModelChange)="onChangemonth($event)"
                  ></nz-range-picker>
                </nz-form-control>
              </nz-form-item>
            </div>

            <div nz-col nzSpan="9">
              <nz-form-item>
                <nz-form-label nzNoColon class="filter"
                  >Residence Type</nz-form-label
                >
                <nz-form-control>
                  <nz-select
                    nzShowSearch
                    nzAllowClear
                    nzPlaceHolder="Please Select Residence Type "
                    name="Residence Type"
                    nzMode="multiple"
                    [nzMaxTagCount]="3"
                    [(ngModel)]="RESIDENCE_TYPE_IDD"
                  >
                    <nz-option
                      *ngFor="let type of emp"
                      [nzValue]="type.ID"
                      [nzLabel]="type.TYPE"
                    >
                    </nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>

            <div
              nz-col
              nzSpan="8"
              style="display: flex; gap: 10px; margin-top: 31px"
            >
              <button
                nz-button
                [nzLoading]="isSpinning"
                nzType="primary"
                class="flexicons"
                (click)="applyFilter()"
              >
                <i nz-icon nzType="filter"></i>Apply Filter
              </button>
              <button nz-button nzType="default" (click)="clearFilter()">
                <i nz-icon nzType="close"></i>Clear filter
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div nz-row>
  <div nz-col nzSpan="3"></div>

  <div nz-col nzSpan="6" style="padding: 5px; cursor: pointer">
    <div style="text-align: center">
      <button
        [ngClass]="showcolor3 == 1 ? 'button-29' : 'button-28'"
        role="button"
        (click)="clickevent('P')"
      >
        Pending
        <span>
          {{ PENDING_COUNT ? PENDING_COUNT : 0 }}
        </span>
      </button>
    </div>
  </div>
  <div nz-col nzSpan="6" style="padding: 5px; cursor: pointer">
    <div style="text-align: center">
      <button
        [ngClass]="showcolor1 == 1 ? 'button-29' : 'button-28'"
        role="button"
        (click)="clickevent('A')"
      >
        Approved
        <span>
          {{ APPROVE_COUNT ? APPROVE_COUNT : 0 }}
        </span>
      </button>
    </div>
  </div>
  <div nz-col nzSpan="6" style="padding: 5px; cursor: pointer">
    <div style="text-align: center">
      <button
        [ngClass]="showcolor2 == 1 ? 'button-29' : 'button-28'"
        role="button"
        (click)="clickevent('R')"
      >
        Rejected
        <span>
          {{ REJECT_COUNT ? REJECT_COUNT : 0 }}
        </span>
      </button>
    </div>
  </div>

  <div nz-col nzSpan="3"></div>
</div>

<div nz-row>
  <div nz-col nzSpan="24">
    <nz-table
      class="my-scroll no-wrap1"
      nzBordered
      #datatable
      nzShowSizeChanger
      [nzFrontPagination]="false"
      [nzData]="dataList"
      [nzLoading]="loadingRecords"
      [nzSize]="'small'"
      [nzScroll]="{ x: '2000px', y: '85vh' }"
      [nzTotal]="totalRecords"
      [(nzPageIndex)]="pageIndex"
      [(nzPageSize)]="pageSize"
      (nzPageIndexChange)="search()"
      (nzPageSizeChange)="search(true)"
      (nzQueryParams)="sort($event)"
      style="white-space: pre-line"
    >
      <thead>
        <tr>
          <th
            [nzWidth]="APPROVAL_STATUS === 'A' ? '250px' : '200px'"
            style="font-weight: bold; text-align: center"
          >
            Action
          </th>
          <th
            nzWidth="150px"
            nzColumnKey="{{ 'FLAT_APPLICATION_NO' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            Application No.
          </th>
          <th
            nzWidth="230px"
            style="font-weight: bold; text-align: center"
            nzColumnKey="{{ 'EMPLOYEE_NAME' }}"
            [nzSortFn]="true"
          >
            Employee Name
          </th>
          <th
            nzWidth="130px"
            style="font-weight: bold; text-align: center"
            nzColumnKey="{{ 'EMPLOYEE_CODE' }}"
            [nzSortFn]="true"
          >
            Employee Code
          </th>
          <th
            nzWidth="230px"
            nzColumnKey="{{ 'DESIGNATION' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            Designation
          </th>
          <th
            nzWidth="230px"
            nzColumnKey="{{ 'EMAIL_ID' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            Email ID
          </th>
          <th
            nzWidth="130px"
            nzColumnKey="{{ 'MOBILE_NO' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            Mobile No.
          </th>
          <th
            nzWidth="180px"
            nzColumnKey="{{ 'CITY_NAME' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            City
          </th>
          <th
            nzWidth="180px"
            nzColumnKey="{{ 'AREA_NAME' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            Area
          </th>
          <th
            nzWidth="150px"
            nzColumnKey="{{ 'BUILDING_NAME' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            Building Name
          </th>
          <th
            nzWidth="150px"
            nzColumnKey="{{ 'FLAT_NAME' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            Quarter Name
          </th>
          <th
            *ngIf="APPROVAL_STATUS == 'R'"
            nzWidth="250px"
            nzColumnKey="{{ 'RENOVATION_REJECTION_REMARK' }}"
            [nzSortFn]="true"
            style="font-weight: bold; text-align: center"
          >
            Reject Remark
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of datatable.data; let n = index">
          <td style="text-align: center">
            <button
              *ngIf="data.RENOVATION_STATUS == 'P'"
              nz-button
              nzType="primary"
              (click)="approverenovation(data, false)"
              style="
                color: white !important;
                border-radius: 10px;
                font-size: 12px;
              "
            >
              <span>View Renovation Request</span>
            </button>
            <button
              *ngIf="
                data.RENOVATION_STATUS == 'A' && !data.HABITABLE_CERTIFICATE
              "
              nz-button
              nzType="primary"
              (click)="openCertificateModel(data)"
              style="
                color: white !important;
                border-radius: 10px;
                font-size: 12px;
              "
            >
              <span>Upload Habitable Certificate</span>
            </button>
            <button
              *ngIf="
                data.RENOVATION_STATUS == 'A' && data.HABITABLE_CERTIFICATE
              "
              nz-button
              nzType="primary"
              (click)="openCertificate(data)"
              style="
                color: white !important;
                border-radius: 10px;
                font-size: 12px;
              "
            >
              <span>
                <span nz-icon nzType="eye" nzTheme="outline"> </span> &nbsp;View
                Habitable Certificate</span
              >
            </button>
          </td>
          <td style="text-align: center">
            <span *ngIf="data.FLAT_APPLICATION_NO != null">
              <span
                *ngIf="data.FLAT_APPLICATION_NO.length >= 20"
                nz-popover
                [nzPopoverContent]="data.FLAT_APPLICATION_NO"
                nzPopoverPlacement="topLeft"
              >
                {{
                  data["FLAT_APPLICATION_NO"] == null
                    ? "-"
                    : (data.FLAT_APPLICATION_NO | slice : 0 : 20)
                }}{{ data.FLAT_APPLICATION_NO.length > 20 ? "..." : "" }}
              </span>
              <span *ngIf="data.FLAT_APPLICATION_NO.length < 20">
                {{
                  data["FLAT_APPLICATION_NO"] == null
                    ? "-"
                    : (data.FLAT_APPLICATION_NO | slice : 0 : 20)
                }}{{ data.FLAT_APPLICATION_NO.length > 20 ? "..." : "" }}
              </span>
            </span>
            <span *ngIf="data.FLAT_APPLICATION_NO == null">-</span>
          </td>
          <td>
            <span *ngIf="data.EMPLOYEE_NAME != null">
              <span
                *ngIf="data.EMPLOYEE_NAME.length >= 20"
                nz-popover
                [nzPopoverContent]="data.EMPLOYEE_NAME"
                nzPopoverPlacement="topLeft"
              >
                {{
                  data["EMPLOYEE_NAME"] == null
                    ? "-"
                    : (data.EMPLOYEE_NAME | slice : 0 : 20)
                }}{{ data.EMPLOYEE_NAME.length > 20 ? "..." : "" }}
              </span>
              <span *ngIf="data.EMPLOYEE_NAME.length < 20">
                {{
                  data["EMPLOYEE_NAME"] == null
                    ? "-"
                    : (data.EMPLOYEE_NAME | slice : 0 : 20)
                }}{{ data.EMPLOYEE_NAME.length > 20 ? "..." : "" }}
              </span>
            </span>
            <span *ngIf="data.EMPLOYEE_NAME == null">-</span>
          </td>
          <td style="white-space: pre-line; text-align: center">
            {{ data["EMPLOYEE_CODE"] ? data["EMPLOYEE_CODE"] : "-" }}
          </td>
          <td>
            <span *ngIf="data.DESIGNATION != null">
              <span
                *ngIf="data.DESIGNATION.length >= 20"
                nz-popover
                [nzPopoverContent]="data.DESIGNATION"
                nzPopoverPlacement="topLeft"
              >
                {{
                  data["DESIGNATION"] == null
                    ? "-"
                    : (data.DESIGNATION | slice : 0 : 20)
                }}{{ data.DESIGNATION.length > 20 ? "..." : "" }}
              </span>
              <span *ngIf="data.DESIGNATION.length < 20">
                {{
                  data["DESIGNATION"] == null
                    ? "-"
                    : (data.DESIGNATION | slice : 0 : 20)
                }}{{ data.DESIGNATION.length > 20 ? "..." : "" }}
              </span>
            </span>
            <span *ngIf="data.DESIGNATION == null">-</span>
          </td>
          <td>
            <span *ngIf="data.EMAIL_ID != null">
              <span
                *ngIf="data.EMAIL_ID.length >= 20"
                nz-popover
                [nzPopoverContent]="data.EMAIL_ID"
                nzPopoverPlacement="topLeft"
              >
                {{
                  data["EMAIL_ID"] == null
                    ? "-"
                    : (data.EMAIL_ID | slice : 0 : 20)
                }}{{ data.EMAIL_ID.length > 20 ? "..." : "" }}
              </span>
              <span *ngIf="data.EMAIL_ID.length < 20">
                {{
                  data["EMAIL_ID"] == null
                    ? "-"
                    : (data.EMAIL_ID | slice : 0 : 20)
                }}{{ data.EMAIL_ID.length > 20 ? "..." : "" }}
              </span>
            </span>
            <span *ngIf="data.EMAIL_ID == null">-</span>
          </td>
          <td
            class="textOverflow"
            style="white-space: pre-line; text-align: center"
          >
            {{ data["MOBILE_NO"] ? data["MOBILE_NO"] : "-" }}
          </td>
          <td
            class="textOverflow"
            style="white-space: pre-line; text-align: center"
          >
            {{ data["CITY_NAME"] ? data["CITY_NAME"] : "-" }}
          </td>
          <td
            class="textOverflow"
            style="white-space: pre-line; text-align: center"
          >
            {{ data["AREA_NAME"] ? data["AREA_NAME"] : "-" }}
          </td>
          <td
            class="textOverflow"
            style="white-space: pre-line; text-align: center"
          >
            {{ data["BUILDING_NAME"] ? data["BUILDING_NAME"] : "-" }}
          </td>
          <td
            class="textOverflow"
            style="white-space: pre-line; text-align: center"
          >
            {{ data["FLAT_NAME"] ? data["FLAT_NAME"] : "-" }}
          </td>
          <td
            *ngIf="APPROVAL_STATUS == 'R'"
            class="textOverflow"
            style="white-space: pre-line; text-align: center"
          >
            {{
              data["RENOVATION_REJECTION_REMARK"]
                ? data["RENOVATION_REJECTION_REMARK"]
                : "-"
            }}
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>
</div>

<div *ngIf="renovationshow">
  <nz-drawer
    [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '10px',
      'padding-left': '14px',
      'padding-right': '14px'
    }"
    [nzClosable]="true"
    [nzMask]="true"
    [nzMaskClosable]="false"
    [nzWidth]="510"
    (nzOnClose)="cancelrenovation()"
    [nzVisible]="renovationshow"
    [nzTitle]="'Renovation Request'"
    (nzKeyboard)="(false)"
  >
    <ng-container *nzDrawerContent>
      <nz-spin [nzSpinning]="isSpinningrenovation">
        <div style="padding: 5px" class="my-boxObj">
          <div nz-row>
            <div nz-col nzSpan="24">
              <label style="font-weight: 500; display: block"
                >Employee Name:
                <span
                  style="font-weight: 400; font-size: 13px"
                  *ngIf="renovationdatad != undefined"
                >
                  {{ renovationdatad.EMPLOYEE_NAME }}</span
                >
              </label>
            </div>
            <div nz-col nzSpan="24" *ngIf="renovationdatad != undefined">
              <label style="font-weight: 500; display: block"
                >Employee Code:
                <span style="font-weight: 400; font-size: 13px">
                  {{
                    renovationdatad.EMPLOYEE_CODE
                      ? renovationdatad.EMPLOYEE_CODE
                      : "-"
                  }}
                </span>
              </label>
            </div>
          </div>
          <div nz-row>
            <div nz-col nzSpan="24" *ngIf="renovationdatad != undefined">
              <label style="font-weight: 500; display: block"
                >Designation:
                <span style="font-weight: 400; font-size: 13px">{{
                  renovationdatad.DESIGNATION
                }}</span>
              </label>
            </div>
          </div>
          <div nz-row>
            <div nz-col nzSpan="24" *ngIf="renovationdatad != undefined">
              <label style="font-weight: 500; display: block"
                >Renovation Remark :
                <span style="font-weight: 400; font-size: 13px">
                  {{ renovationdatad.RENOVATION_REMARK }}</span
                ></label
              >
            </div>
            <div
              nz-col
              nzSpan="24"
              *ngIf="
                renovationdatad.RENOVATION_ATTACHEMENTS != null &&
                renovationdatad.RENOVATION_ATTACHEMENTS != undefined &&
                renovationdatad.RENOVATION_ATTACHEMENTS != ''
              "
            >
              <label
                style="font-weight: 500; display: block"
                *ngIf="renovationdatad != undefined"
                >Attachment:
                <span style="font-weight: 400; font-size: 13px">
                  {{ renovationdatad.RENOVATION_ATTACHEMENTS }} &nbsp;
                  <span
                    nz-icon
                    nzTooltipTitle="Preview"
                    nzTooltipPlacement="top"
                    nz-tooltip
                    nzType="eye"
                    nzTheme="outline"
                    style="cursor: pointer; color: #1890ff"
                    (click)="
                      Viewoccupancyformletter1(
                        renovationdatad.RENOVATION_ATTACHEMENTS
                      )
                    "
                  ></span> </span
              ></label>
            </div>
          </div>
        </div>
        <div nz-row *ngIf="renovationdatad != undefined">
          <div nz-col nzSpan="24">
            <nz-form-item class="nz-form-item1">
              <nz-form-label style="padding: 0px 0px" nzRequired nzNoColon
                >Renovation Status</nz-form-label
              >
              <nz-form-control>
                <nz-radio-group name="type" [(ngModel)]="renst">
                  <label nz-radio nzValue="A">Approve</label>
                  <label nz-radio nzValue="R">Reject</label>
                </nz-radio-group>
              </nz-form-control></nz-form-item
            >
          </div>
          <div nz-col nzSpan="24" style="padding: 5px" *ngIf="renst == 'R'">
            <nz-form-item class="nz-form-item1">
              <nz-form-label style="padding: 0px 10px" nzRequired nzNoColon
                >Rejection Remark</nz-form-label
              >
              <nz-form-control nzRequired nzErrorTip>
                <textarea
                  required
                  maxlength="512"
                  placeHolder="Enter Rejection Remark"
                  style="width: 100%; height: 100%"
                  [(ngModel)]="renovationdatad.RENOVATION_REJECTION_REMARK"
                  name="RENOVATION_REJECTION_REMARK"
                  [nzAutosize]="{ minRows: 3, maxRows: 3 }"
                  nz-input
                ></textarea>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </nz-spin>

      <div class="footer" *ngIf="renovationdatad != undefined">
        <button
          nz-button
          nzType="default"
          class="btn btn-primary"
          [nzLoading]="isSpinningrenovation"
          (click)="cancelrenovation()"
        >
          Cancel</button
        >&nbsp;

        <button
          *ngIf="renst == 'R'"
          nz-button
          nzType="primary"
          class="btn btn-primary"
          [nzLoading]="isSpinningrenovation"
          style="background-color: red"
          (click)="rejectrenovation()"
        >
          Reject Renovation</button
        >&nbsp;
        <button
          *ngIf="renst == 'A'"
          nz-button
          nzType="primary"
          class="btn btn-primary"
          [nzLoading]="isSpinningrenovation"
          (click)="approverrenovation()"
        >
          Approve Renovation</button
        >&nbsp;
      </div>
    </ng-container>
  </nz-drawer>
</div>

<nz-modal
  nzTitle="Upload Habitable Certificate"
  [(nzVisible)]="modalVisible"
  nzCentered="true"
  [nzBodyStyle]="{ padding: '16px' }"
  nzWidth="450px"
  nzClosable="false"
  [nzFooter]="contextofrulesss"
  nzMaskClosable="false"
>
  <ng-container *nzModalContent>
    <nz-spin [nzSpinning]="isSpinning">
      <div nz-row>
        <div nz-col nzSpan="24">
          <nz-form-item>
            <nz-form-label nzRequired nzNoColon>Certificate </nz-form-label>
            <nz-form-control>
              <button
                nz-button
                style="height: 28px; padding: 0px 7px; font-size: 12px"
                (click)="fileInput.click()"
              >
                Upload Certificate
                <input
                  #fileInput
                  name="Certificate"
                  type="file"
                  (click)="fileInput.value = ''"
                  value=""
                  (change)="onFileSelected($event)"
                  style="display: none"
                  required
                />
              </button>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div nz-row>
        <div nz-col nzSpan="24">
          <div
            *ngIf="URL != null && URL != '' && URL != undefined"
            style="
              font-size: 11px;
              display: block;
              width: 100%;
              color: #1890ff;
              padding-left: 10px;
            "
          >
            {{ URL }} &nbsp;&nbsp;

            <!-- <span
          nz-icon
          nzType="delete"
          nzTheme="outline"
          nzTooltipTitle="Remove"
          nzTooltipPlacement="top"
          nz-tooltip
          style="cursor: pointer; color: red"
          (click)="
            clearprofile(URL, 'profileImages')
          "
        ></span> -->
          </div>
        </div>
      </div>
      <div nz-row>
        <div nz-col nzSpan="6" *ngIf="progressBar"></div>
        <div nz-col nzSpan="12" *ngIf="progressBar">
          <nz-progress [nzPercent]="percent"></nz-progress>
        </div>
        <div nz-col nzSpan="6" *ngIf="progressBar"></div>
      </div>
    </nz-spin>
  </ng-container>
  <ng-template #contextofrulesss>
    <button
      nzSize="small"
      [nzLoading]="loadingRecords"
      nz-button
      nzType="primary"
      class="btn btn-primary"
      style="background-color: #006699; font-size: 11px"
      nz-popconfirm
      nzPopconfirmTitle="Are you sure want to upload the certificate?"
      nzPopconfirmPlacement="top"
      (nzOnConfirm)="uploadCertificate()"
      [nzOkText]="'Upload'"
      (nzOnCancel)="cancel()"
    >
      Upload
    </button>

    <button
      nzSize="small"
      nz-button
      nzType="primary"
      [nzLoading]="loadingRecords"
      class="btn btn-primary"
      style="
        background-color: white !important;

        color: #006699;
        font-size: 11px;
        font-weight: 500;
      "
      (click)="closeModal()"
    >
      Cancel
    </button>
  </ng-template>
</nz-modal>
